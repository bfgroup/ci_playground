# Use, modification, and distribution are
# subject to the Boost Software License, Version 1.0. (See accompanying
# file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
#
# Copyright Rene Rivera 2020.

version: v1.0
name: C++ Tooling

# Need a default / placeholder agent as otherwise the fake blocks error in
# YAML parsing as they don't get an agent.
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  # These are fake blocks defining various yaml reusable items.
  # We need the fake blocks as teh Semaphore YAML parser doesn't allow custom
  # keys on anything.

  - name: Definitions
    dependencies: []
    skip: { when: true }
    task:
      jobs:
        - name: Placeholder
          commands: []

  - name: Linux Definitions
    dependencies: ["Definitions"]
    skip: { when: true }
    task:
      prologue: &linux_prologue
        commands:
          - checkout
          - uname -a
          - ./.ci_playground/linux-cxx-install.sh
          - export 'CXXFLAGS=-v'
      jobs: &linux_jobs
        - name: Compile
          commands:
            - export 'CXXFLAGS=-v'
            - ${CXX} --version
            - ${CXX} ${CXXFLAGS} src/main.cpp
      agent: &linux_agent
        machine:
          type: e1-standard-2
          os_image: ubuntu1804

  # Our real blocks..

  - name: Linux
    dependencies: []
    skip: { when: true }
    task:
      jobs:
        - name: Placeholder
          commands: []
  - name: Linux GCC 9, Install
    dependencies: ["Linux"]
    task:
      env_vars: [{name: CXX, value: g++-9}, {name: PACKAGES, value: g++-9}]
      prologue: *linux_prologue
      jobs: *linux_jobs
      agent: *linux_agent
  - name: Linux GCC 8, Install
    dependencies: ["Linux"]
    task:
      env_vars: [{name: CXX, value: g++-8}, {name: PACKAGES, value: g++-8}]
      prologue: *linux_prologue
      jobs: *linux_jobs
      agent: *linux_agent
